<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Domain Reconnaissance Platform</title>
    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/index.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/map.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/geodata/worldLow.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/themes/Animated.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #3b82f6;
            --secondary-color: #14b8a6;
            --accent-color: #f59e0b;
            --danger-color: #ef4444;
            --warning-color: #f59e0b;
            --success-color: #10b981;
            --dark-bg: #0a0e27;
            --card-bg: #1a1f3a;
            --card-hover: #232945;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --border-color: #2d3548;
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-hero: linear-gradient(135deg, #1e40af 0%, #7c3aed 50%, #db2777 100%);
            --gradient-card: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--dark-bg);
            background-image:
                radial-gradient(at 0% 0%, rgba(59, 130, 246, 0.1) 0px, transparent 50%),
                radial-gradient(at 100% 0%, rgba(139, 92, 246, 0.1) 0px, transparent 50%),
                radial-gradient(at 100% 100%, rgba(236, 72, 153, 0.1) 0px, transparent 50%);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header */
        .header {
            background: var(--gradient-hero);
            padding: 3rem 0;
            text-align: center;
            position: relative;
            overflow: hidden;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="rgba(255,255,255,0.05)" stroke-width="0.5"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
            opacity: 0.5;
        }

        .header::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 50% 50%, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
        }

        .header h1 {
            font-size: 3.5rem;
            font-weight: 800;
            margin-bottom: 0.75rem;
            position: relative;
            z-index: 1;
            text-shadow: 2px 2px 8px rgba(0,0,0,0.3);
            letter-spacing: -0.02em;
        }

        .header p {
            font-size: 1.25rem;
            opacity: 0.95;
            position: relative;
            z-index: 1;
            color: rgba(255, 255, 255, 0.9);
        }

        /* Navigation Tabs */
        .nav-tabs {
            display: flex;
            justify-content: center;
            margin: 2rem 0;
            background: var(--card-bg);
            border-radius: 12px;
            padding: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .nav-tab {
            padding: 12px 24px;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .nav-tab.active {
            background: var(--primary-color);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }

        .nav-tab:hover:not(.active) {
            background: rgba(37, 99, 235, 0.1);
            color: var(--text-primary);
        }

        /* Tab Content */
        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Scan Section */
        .scan-section {
            background: var(--card-bg);
            background-image: var(--gradient-card);
            border-radius: 20px;
            padding: 2.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            border: 1px solid var(--border-color);
        }

        .scan-form {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            align-items: stretch;
        }

        .domain-input {
            flex: 1;
            padding: 18px 24px;
            background: rgba(10, 14, 39, 0.6);
            backdrop-filter: blur(10px);
            border: 2px solid var(--border-color);
            border-radius: 14px;
            color: var(--text-primary);
            font-size: 1.1rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .domain-input::placeholder {
            color: var(--text-secondary);
            opacity: 0.6;
        }

        .domain-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.15);
            background: rgba(10, 14, 39, 0.8);
        }

        .scan-btn {
            padding: 18px 40px;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            border: none;
            border-radius: 14px;
            color: white;
            font-weight: 600;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
        }

        .scan-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .scan-btn:hover::before {
            left: 100%;
        }

        .scan-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(59, 130, 246, 0.5);
        }

        .scan-btn:active {
            transform: translateY(-1px);
        }

        .scan-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Progress Bar */
        .progress-container {
            margin: 2rem 0;
            display: none;
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: rgba(45, 53, 72, 0.5);
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            width: 0%;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .progress-text {
            text-align: center;
            margin-top: 1rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        /* Results Section */
        .results-section {
            display: none;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .result-card {
            background: var(--card-bg);
            background-image: var(--gradient-card);
            border-radius: 20px;
            padding: 2rem;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.15);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .result-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .result-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 12px 40px rgba(59, 130, 246, 0.2);
            background: var(--card-hover);
            border-color: rgba(59, 130, 246, 0.3);
        }

        .result-card:hover::before {
            opacity: 1;
        }

        .result-card h3 {
            color: var(--primary-color);
            margin-bottom: 1rem;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Graph Container */
        .dendrogram-container {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 2rem;
            margin: 2rem 0;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }

        #domain-dendrogram {
            width: 100%;
            height: 500px;
            border-radius: 12px;
            background: var(--dark-bg);
        }

        /* Public Monitoring */
        .monitoring-list {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 2rem;
            margin: 2rem 0;
            border: 1px solid var(--border-color);
        }

        .monitoring-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .monitoring-item:hover {
            background: rgba(37, 99, 235, 0.05);
        }

        .monitoring-item:last-child {
            border-bottom: none;
        }

        .monitoring-domain {
            font-weight: 600;
            color: var(--text-primary);
        }

        .monitoring-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success-color);
        }

        .status-indicator.has-updates {
            background: var(--warning-color);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Toast Notifications */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--success-color);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 1000;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.error {
            background: var(--danger-color);
        }

        .toast.warning {
            background: var(--warning-color);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }

            .scan-form {
                flex-direction: column;
            }

            .nav-tabs {
                flex-wrap: wrap;
                gap: 0.5rem;
            }

            .results-section {
                grid-template-columns: 1fr;
            }
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Workflow Results */
        .workflow-results {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
            margin-top: 2rem;
        }

        .workflow-card {
            background: var(--dark-bg);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid var(--border-color);
        }

        .workflow-card h4 {
            color: var(--secondary-color);
            margin-bottom: 1rem;
        }

        .workflow-status {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 500;
            background: var(--success-color);
            color: white;
        }

        /* Globe Map */
        #globe-map {
            width: 100%;
            height: 500px;
            border-radius: 16px;
            background: var(--dark-bg);
            margin: 1rem 0;
        }

        .globe-container {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 2rem;
            margin: 2rem 0;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.15);
        }

        /* Domain Info Table */
        .domain-info-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        .domain-info-table th,
        .domain-info-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .domain-info-table th {
            color: var(--primary-color);
            font-weight: 600;
            width: 30%;
        }

        .domain-info-table td {
            color: var(--text-primary);
            font-family: monospace;
        }

        .domain-info-table tr:hover {
            background: rgba(59, 130, 246, 0.05);
        }

        /* OWASP Results */
        .owasp-results {
            display: grid;
            gap: 1rem;
            margin-top: 1rem;
        }

        .owasp-item {
            padding: 1rem;
            background: var(--dark-bg);
            border-radius: 8px;
            border-left: 4px solid var(--border-color);
        }

        .owasp-item.vulnerable {
            border-left-color: var(--danger-color);
        }

        .owasp-item.warning {
            border-left-color: var(--warning-color);
        }

        .owasp-item.passed {
            border-left-color: var(--success-color);
        }

        .owasp-badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 0.5rem;
        }

        .owasp-badge.vulnerable {
            background: var(--danger-color);
            color: white;
        }

        .owasp-badge.warning {
            background: var(--warning-color);
            color: white;
        }

        .owasp-badge.passed {
            background: var(--success-color);
            color: white;
        }

        /* Wayback Machine Styles */
        .wayback-container {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 2rem;
            margin: 2rem 0;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.15);
        }

        .wayback-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .wayback-stat {
            background: var(--dark-bg);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .wayback-stat:hover {
            transform: translateY(-3px);
            border-color: var(--primary-color);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
        }

        .wayback-stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .wayback-stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .snapshot-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .snapshot-card {
            background: var(--dark-bg);
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid var(--border-color);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
        }

        .snapshot-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary-color);
            box-shadow: 0 8px 24px rgba(59, 130, 246, 0.3);
        }

        .snapshot-thumbnail {
            width: 100%;
            height: 180px;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .snapshot-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .snapshot-thumbnail img.loaded {
            opacity: 1;
        }

        .snapshot-thumbnail iframe {
            width: 100%;
            height: 100%;
            border: none;
            pointer-events: none;
            transform: scale(0.5);
            transform-origin: top left;
            width: 200%;
            height: 200%;
        }

        .snapshot-thumbnail-placeholder {
            color: var(--text-secondary);
            text-align: center;
        }

        .snapshot-thumbnail-placeholder i {
            font-size: 3rem;
            margin-bottom: 0.5rem;
            opacity: 0.3;
        }

        .snapshot-info {
            padding: 1.25rem;
        }

        .snapshot-date {
            color: var(--primary-color);
            font-weight: 600;
            font-size: 0.95rem;
            margin-bottom: 0.5rem;
        }

        .snapshot-timestamp {
            color: var(--text-secondary);
            font-size: 0.85rem;
            font-family: monospace;
        }

        .snapshot-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .snapshot-btn {
            flex: 1;
            padding: 0.5rem 1rem;
            background: var(--primary-color);
            border: none;
            border-radius: 6px;
            color: white;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .snapshot-btn:hover {
            background: var(--secondary-color);
            transform: scale(1.05);
        }

        .timeline-container {
            background: var(--dark-bg);
            border-radius: 12px;
            padding: 2rem;
            margin: 2rem 0;
            border: 1px solid var(--border-color);
        }

        .timeline {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-top: 1rem;
        }

        .timeline-year {
            padding: 0.5rem 1rem;
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-weight: 500;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .timeline-year:hover {
            background: var(--primary-color);
            color: white;
            transform: translateY(-2px);
        }

        .timeline-year.active {
            background: var(--primary-color);
            color: white;
        }

        .wayback-archive-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 1rem 1.5rem;
            background: linear-gradient(135deg, var(--accent-color) 0%, var(--warning-color) 100%);
            border-radius: 12px;
            color: white;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 1rem 0;
        }

        .wayback-archive-link:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(245, 158, 11, 0.4);
        }

        .no-snapshots {
            text-align: center;
            padding: 3rem;
            color: var(--text-secondary);
        }

        .no-snapshots i {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.3;
        }

        @media (max-width: 768px) {
            .snapshot-gallery {
                grid-template-columns: 1fr;
            }

            .wayback-stats {
                grid-template-columns: 1fr;
            }

            .timeline {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <h1><i class="fas fa-shield-alt"></i> AI-Powered Cybersecurity Intelligence Platform</h1>
            <p>AI-Powered Cybersecurity Intelligence Platform</p>
        </div>
    </div>

    <div class="container">
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('scanner')">
                <i class="fas fa-search"></i> Domain Scanner
            </button>
            <button class="nav-tab" onclick="switchTab('monitoring')">
                <i class="fas fa-eye"></i> Public Monitoring
            </button>
            <button class="nav-tab" onclick="switchTab('workflows')">
                <i class="fas fa-cogs"></i> Automation
            </button>
        </div>

        <!-- Scanner Tab -->
        <div id="scanner" class="tab-content active">
            <div class="scan-section">
                <h2><i class="fas fa-radar"></i> Comprehensive Domain Analysis</h2>
                <p>Enter a domain to perform complete reconnaissance, threat analysis, and security assessment</p>
                
                <div class="scan-form">
                    <input type="text" id="domainInput" class="domain-input" placeholder="Enter domain (e.g., example.com)" />
                    <button id="scanBtn" class="scan-btn" onclick="startComprehensiveScan()">
                        <i class="fas fa-play"></i> Analyze Domain
                    </button>
                </div>

                <div id="progressContainer" class="progress-container">
                    <div class="progress-bar">
                        <div id="progressFill" class="progress-fill"></div>
                    </div>
                    <div id="progressText" class="progress-text">Initializing scan...</div>
                </div>
            </div>

            <div id="globeContainer" class="globe-container" style="display: none;">
                <h3><i class="fas fa-globe"></i> IP Geolocation Map</h3>
                <div id="globe-map"></div>
            </div>

            <div id="domainInfoContainer" class="globe-container" style="display: none;">
                <h3><i class="fas fa-info-circle"></i> Domain Information</h3>
                <div id="domain-info-content"></div>
            </div>

            <div id="resultsSection" class="results-section"></div>

            <div id="waybackContainer" class="wayback-container" style="display: none;">
                <h3><i class="fas fa-history"></i> Wayback Machine Archives</h3>
                <div id="wayback-content"></div>
            </div>

            <div id="owaspContainer" class="globe-container" style="display: none;">
                <h3><i class="fas fa-shield-alt"></i> OWASP Security Analysis</h3>
                <div id="owasp-results"></div>
            </div>

            <div id="dendrogramContainer" class="dendrogram-container" style="display: none;">
                <h3><i class="fas fa-sitemap"></i> Domain Relationship Dendrogram</h3>
                <div id="domain-dendrogram"></div>
            </div>
        </div>

        <!-- Public Monitoring Tab -->
        <div id="monitoring" class="tab-content">
            <div class="scan-section">
                <h2><i class="fas fa-eye"></i> Public Domain Monitoring</h2>
                <p>Add domains to public monitoring - anyone can see updates and changes</p>
                
                <div class="scan-form">
                    <input type="text" id="monitorDomainInput" class="domain-input" placeholder="Enter domain to monitor" />
                    <button id="addMonitorBtn" class="scan-btn" onclick="addToMonitoring()">
                        <i class="fas fa-plus"></i> Add to Monitoring
                    </button>
                </div>
            </div>

            <div class="monitoring-list">
                <h3><i class="fas fa-list"></i> Currently Monitored Domains</h3>
                <div id="monitoringList">
                    <p class="progress-text">Loading monitoring list...</p>
                </div>
            </div>
        </div>

        <!-- Workflows Tab -->
        <div id="workflows" class="tab-content">
            <div class="scan-section">
                <h2><i class="fas fa-cogs"></i> Automated Security Workflows</h2>
                <p>All workflows are automatically executed during domain analysis</p>
                
                <div class="workflow-results">
                    <div class="workflow-card">
                        <h4><i class="fas fa-shield-alt"></i> Comprehensive Security Scan</h4>
                        <span class="workflow-status">Auto-Executed</span>
                        <p>Full domain reconnaissance with threat analysis, SSL checks, and vulnerability assessment</p>
                    </div>
                    
                    <div class="workflow-card">
                        <h4><i class="fas fa-search"></i> Threat Hunter Workflow</h4>
                        <span class="workflow-status">Auto-Executed</span>
                        <p>Advanced threat detection, AI-powered risk scoring, and malware analysis</p>
                    </div>
                    
                    <div class="workflow-card">
                        <h4><i class="fas fa-clipboard-check"></i> Compliance Audit</h4>
                        <span class="workflow-status">Auto-Executed</span>
                        <p>Security compliance checks, OWASP Top 10 analysis, and header validation</p>
                    </div>
                    
                    <div class="workflow-card">
                        <h4><i class="fas fa-coins"></i> Web3 Analysis</h4>
                        <span class="workflow-status">Auto-Executed</span>
                        <p>Blockchain domain scanning, crypto threat detection, and NFT analysis</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let socket;
        let currentScanId = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initializeSocket();
            loadPublicMonitoring();
            
            // Enter key support
            document.getElementById('domainInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    startComprehensiveScan();
                }
            });
            
            document.getElementById('monitorDomainInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    addToMonitoring();
                }
            });
        });

        function initializeSocket() {
            socket = io();
            
            socket.on('connect', function() {
                console.log('Connected to server');
            });

            socket.on('scan_progress', function(data) {
                if (data.scan_id === currentScanId) {
                    updateProgress(data.progress, data.message);
                }
            });

            socket.on('scan_error', function(data) {
                if (data.scan_id === currentScanId) {
                    showToast('Scan failed: ' + data.error, 'error');
                    resetScanButton();
                }
            });
        }

        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all nav tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            // Load data for specific tabs
            if (tabName === 'monitoring') {
                loadPublicMonitoring();
            }
        }

        function startComprehensiveScan() {
            const domain = document.getElementById('domainInput').value.trim();
            
            if (!domain) {
                showToast('Please enter a domain', 'warning');
                return;
            }

            // Validate domain format
            const domainRegex = /^[a-zA-Z0-9][a-zA-Z0-9-]{0,61}[a-zA-Z0-9]?(\.[a-zA-Z0-9][a-zA-Z0-9-]{0,61}[a-zA-Z0-9]?)*\.[a-zA-Z]{2,}$/;
            if (!domainRegex.test(domain)) {
                showToast('Please enter a valid domain', 'error');
                return;
            }

            // Start scan
            document.getElementById('scanBtn').disabled = true;
            document.getElementById('scanBtn').innerHTML = '<div class="loading"></div> Analyzing...';
            document.getElementById('progressContainer').style.display = 'block';
            document.getElementById('resultsSection').style.display = 'none';
            document.getElementById('dendrogramContainer').style.display = 'none';

            fetch('/api/scan', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    domain: domain
                }),
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    throw new Error(data.error);
                }
                
                currentScanId = data.scan_id;
                socket.emit('join_scan', { scan_id: currentScanId });
                
                // Poll for results
                pollScanResults(currentScanId);
            })
            .catch(error => {
                showToast('Error starting scan: ' + error.message, 'error');
                resetScanButton();
            });
        }

        function pollScanResults(scanId) {
            const poll = () => {
                fetch(`/api/scan/${scanId}/status`)
                    .then(response => response.json())
                    .then(data => {
                        console.log('Poll response:', data);
                        if (data.status === 'completed') {
                            console.log('Scan completed, displaying results...');
                            displayResults(data.result);
                            resetScanButton();
                            showToast('Scan completed successfully!', 'success');
                        } else if (data.status === 'error') {
                            console.error('Scan error:', data.error);
                            showToast('Scan failed: ' + data.error, 'error');
                            resetScanButton();
                        } else {
                            console.log('Scan in progress, status:', data.status, 'progress:', data.progress);
                            setTimeout(poll, 2000);
                        }
                    })
                    .catch(error => {
                        console.error('Error polling scan status:', error);
                        showToast('Error checking scan status: ' + error.message, 'error');
                        resetScanButton();
                    });
            };

            setTimeout(poll, 1000);
        }

        function updateProgress(progress, message) {
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('progressText').textContent = message;
        }

        function resetScanButton() {
            document.getElementById('scanBtn').disabled = false;
            document.getElementById('scanBtn').innerHTML = '<i class="fas fa-play"></i> Analyze Domain';
            document.getElementById('progressContainer').style.display = 'none';
        }

        function displayResults(data) {
            console.log('displayResults called with data:', data);
            const resultsSection = document.getElementById('resultsSection');
            if (!resultsSection) {
                console.error('resultsSection element not found!');
                return;
            }
            resultsSection.style.display = 'grid';

            // Display geolocation map if available
            if (data.geolocation && data.geolocation.success) {
                displayGlobeMap(data.geolocation, data.domain);
            }

            // Display domain information
            displayDomainInfo(data);

            // Display OWASP analysis if available
            if (data.owasp_analysis) {
                displayOWASPResults(data.owasp_analysis);
            }

            // Display Wayback Machine data if available
            if (data.wayback_data) {
                displayWaybackData(data.wayback_data, data.domain);
            }

            let html = '';
            
            // Authenticity Card
            const auth = data.authenticity || {};
            const confidence = auth.confidence_score || 0;
            const isGenuine = auth.is_genuine !== false;
            
            html += `
                <div class="result-card">
                    <h3><i class="fas fa-shield-${isGenuine ? 'check' : 'exclamation'}"></i> Authenticity Assessment</h3>
                    <div style="margin-bottom: 1rem;">
                        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                            <div style="font-size: 2rem;">${isGenuine ? '✅' : '⚠️'}</div>
                            <div>
                                <div style="font-weight: 600; color: ${isGenuine ? 'var(--success-color)' : 'var(--warning-color)'};">
                                    ${isGenuine ? 'Genuine Domain' : 'Potential Risk'}
                                </div>
                                <div style="color: var(--text-secondary);">Confidence: ${confidence}/100</div>
                            </div>
                        </div>
                        ${!isGenuine && data.official_link ? `<p><strong>Official Link:</strong> <a href="${data.official_link}" target="_blank" style="color: var(--primary-color);">${data.official_link}</a></p>` : ''}
                    </div>
                </div>
            `;
            
            // Threat Analysis Card
            const threat = data.threat_analysis || {};
            const riskScore = threat.risk_score || 0;
            const riskColor = riskScore > 70 ? 'var(--danger-color)' : riskScore > 40 ? 'var(--warning-color)' : 'var(--success-color)';
            
            html += `
                <div class="result-card">
                    <h3><i class="fas fa-exclamation-triangle"></i> AI Threat Analysis</h3>
                    <div style="margin-bottom: 1rem;">
                        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                            <div style="width: 60px; height: 60px; border-radius: 50%; background: conic-gradient(${riskColor} ${riskScore * 3.6}deg, var(--border-color) 0deg); display: flex; align-items: center; justify-content: center;">
                                <div style="width: 45px; height: 45px; border-radius: 50%; background: var(--card-bg); display: flex; align-items: center; justify-content: center; font-weight: bold;">
                                    ${riskScore}
                                </div>
                            </div>
                            <div>
                                <div style="font-weight: 600; color: ${riskColor};">Risk Score: ${riskScore}/100</div>
                                <div style="color: var(--text-secondary);">Phishing Risk: ${threat.phishing_risk || 'Unknown'}</div>
                                <div style="color: var(--text-secondary);">Anomaly: ${threat.is_anomaly ? 'Detected' : 'None'}</div>
                            </div>
                        </div>
                        ${threat.rule_based_flags && threat.rule_based_flags.length > 0 ? `
                            <div style="margin-top: 1rem;">
                                <strong>Security Flags:</strong>
                                <ul style="margin-top: 0.5rem; padding-left: 1rem;">
                                    ${threat.rule_based_flags.map(flag => `<li style="color: var(--warning-color);">${flag}</li>`).join('')}
                                </ul>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
            
            // Workflow Results Card
            const workflows = data.workflow_results || {};
            html += `
                <div class="result-card">
                    <h3><i class="fas fa-cogs"></i> Automated Workflows</h3>
                    <div style="display: grid; gap: 1rem;">
                        ${Object.entries(workflows).map(([key, workflow]) => `
                            <div style="padding: 1rem; background: var(--dark-bg); border-radius: 8px; border: 1px solid var(--border-color);">
                                <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 0.5rem;">
                                    <strong style="color: var(--secondary-color);">${workflow.description || key}</strong>
                                    <span style="background: var(--success-color); color: white; padding: 0.25rem 0.5rem; border-radius: 12px; font-size: 0.75rem;">
                                        ${workflow.status || 'Completed'}
                                    </span>
                                </div>
                                ${workflow.compliance_score ? `<div>Compliance Score: ${workflow.compliance_score}/100</div>` : ''}
                                ${workflow.risk_score ? `<div>Risk Assessment: ${workflow.risk_score}/100</div>` : ''}
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            // Web3 Analysis Card
            const web3 = data.web3_analysis || {};
            if (web3.ens_data || web3.unstoppable_data || web3.blockchain_analysis) {
                html += `
                    <div class="result-card">
                        <h3><i class="fas fa-coins"></i> Web3 & Blockchain Analysis</h3>
                        <div style="display: grid; gap: 1rem;">
                            ${web3.ens_data && web3.ens_data.is_ens ? `
                                <div style="padding: 1rem; background: var(--dark-bg); border-radius: 8px;">
                                    <strong style="color: var(--accent-color);">ENS Domain</strong>
                                    <div>Address: ${web3.ens_data.address || 'N/A'}</div>
                                    <div>Owner: ${web3.ens_data.owner || 'N/A'}</div>
                                </div>
                            ` : ''}
                            ${web3.unstoppable_data && web3.unstoppable_data.is_unstoppable ? `
                                <div style="padding: 1rem; background: var(--dark-bg); border-radius: 8px;">
                                    <strong style="color: var(--accent-color);">Unstoppable Domain</strong>
                                    <div>Owner: ${web3.unstoppable_data.owner || 'N/A'}</div>
                                    <div>IPFS: ${web3.unstoppable_data.ipfs_hash || 'N/A'}</div>
                                </div>
                            ` : ''}
                            ${web3.blockchain_analysis && web3.blockchain_analysis.has_crypto_keywords ? `
                                <div style="padding: 1rem; background: var(--dark-bg); border-radius: 8px;">
                                    <strong style="color: var(--warning-color);">Crypto Keywords Detected</strong>
                                    <div>Keywords: ${web3.blockchain_analysis.has_crypto_keywords.found_keywords ? web3.blockchain_analysis.has_crypto_keywords.found_keywords.join(', ') : 'None'}</div>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }
            
            // Technical Details Card
            const recon = data.reconnaissance || {};
            html += `
                <div class="result-card">
                    <h3><i class="fas fa-server"></i> Technical Details</h3>
                    <div style="display: grid; gap: 0.5rem; font-family: monospace; font-size: 0.9rem;">
                        <div><strong>IP:</strong> ${recon.geolocation?.ip || 'N/A'}</div>
                        <div><strong>Country:</strong> ${recon.geolocation?.country || 'N/A'}</div>
                        <div><strong>ISP:</strong> ${recon.geolocation?.isp || 'N/A'}</div>
                        <div><strong>SSL Valid:</strong> ${recon.ssl?.valid ? '✅ Yes' : '❌ No'}</div>
                        <div><strong>Subdomains:</strong> ${recon.subdomains?.length || 0}</div>
                        <div><strong>Open Ports:</strong> ${recon.open_ports?.length || 0}</div>
                        <div><strong>Technologies:</strong> ${recon.technologies?.length || 0} detected</div>
                    </div>
                </div>
            `;
            
            resultsSection.innerHTML = html;
            
            // Display graph if available
            if (data.graph_data && data.graph_data.nodes && data.graph_data.nodes.length > 0) {
                displayDendrogram(data.graph_data);
            }
        }

        function displayDendrogram(graphData) {
            document.getElementById('dendrogramContainer').style.display = 'block';
            
            // Clear previous dendrogram
            d3.select('#domain-dendrogram').selectAll('*').remove();
            
            const margin = { top: 20, right: 120, bottom: 20, left: 120 };
            const width = 800 - margin.left - margin.right;
            const height = 400 - margin.bottom - margin.top;
            
            const svg = d3.select('#domain-dendrogram')
                .append('svg')
                .attr('width', width + margin.left + margin.right)
                .attr('height', height + margin.top + margin.bottom);
                
            const g = svg.append('g')
                .attr('transform', `translate(${margin.left},${margin.top})`);
            
            // Convert graph data to hierarchical structure
            const hierarchyData = convertToHierarchy(graphData);
            
            const root = d3.hierarchy(hierarchyData);
            const cluster = d3.cluster().size([height, width]);
            cluster(root);
            
            // Add links
            g.selectAll('.link')
                .data(root.descendants().slice(1))
                .enter().append('path')
                .attr('class', 'link')
                .attr('d', d => {
                    return `M${d.y},${d.x}C${(d.y + d.parent.y) / 2},${d.x} ${(d.y + d.parent.y) / 2},${d.parent.x} ${d.parent.y},${d.parent.x}`;
                })
                .style('fill', 'none')
                .style('stroke', '#64748b')
                .style('stroke-width', '2px');
            
            // Add nodes
            const node = g.selectAll('.node')
                .data(root.descendants())
                .enter().append('g')
                .attr('class', 'node')
                .attr('transform', d => `translate(${d.y},${d.x})`);
            
            node.append('circle')
                .attr('r', d => d.data.size || 8)
                .style('fill', d => d.data.color || '#2563eb')
                .style('stroke', '#1e293b')
                .style('stroke-width', '2px');
            
            node.append('text')
                .attr('dy', '.35em')
                .attr('x', d => d.children ? -13 : 13)
                .style('text-anchor', d => d.children ? 'end' : 'start')
                .style('fill', '#f8fafc')
                .style('font-size', '12px')
                .text(d => d.data.name);
            
            // Add tooltips
            node.append('title')
                .text(d => d.data.title || d.data.name);
        }
        
        function convertToHierarchy(graphData) {
            const nodes = graphData.nodes || [];
            const edges = graphData.edges || [];
            
            // Find the main domain (root)
            const mainNode = nodes.find(n => n.type === 'main_domain') || nodes[0];
            if (!mainNode) return { name: 'No Data', children: [] };
            
            const hierarchy = {
                name: mainNode.label,
                color: mainNode.color,
                size: mainNode.size,
                title: mainNode.title,
                children: []
            };
            
            // Group nodes by type
            const nodesByType = {};
            nodes.forEach(node => {
                if (node.id !== mainNode.id) {
                    const type = node.type || 'other';
                    if (!nodesByType[type]) nodesByType[type] = [];
                    nodesByType[type].push({
                        name: node.label,
                        color: node.color,
                        size: node.size / 2,
                        title: node.title
                    });
                }
            });
            
            // Create type groups as children
            Object.entries(nodesByType).forEach(([type, typeNodes]) => {
                hierarchy.children.push({
                    name: type.replace('_', ' ').toUpperCase(),
                    color: '#64748b',
                    size: 6,
                    children: typeNodes
                });
            });
            
            return hierarchy;
        }

        function displayGlobeMap(geolocation, domain) {
            document.getElementById('globeContainer').style.display = 'block';

            const lat = geolocation.latitude || 0;
            const lon = geolocation.longitude || 0;

            // Clear previous map
            const mapDiv = document.getElementById('globe-map');
            mapDiv.innerHTML = '';

            // Create root element
            const root = am5.Root.new("globe-map");

            // Set themes
            root.setThemes([
                am5themes_Animated.new(root)
            ]);

            // Create the map chart
            const chart = root.container.children.push(am5map.MapChart.new(root, {
                panX: "rotateX",
                panY: "rotateY",
                projection: am5map.geoOrthographic(),
                paddingBottom: 20,
                paddingTop: 20,
                paddingLeft: 20,
                paddingRight: 20
            }));

            // Create main polygon series for countries
            const polygonSeries = chart.series.push(am5map.MapPolygonSeries.new(root, {
                geoJSON: am5geodata_worldLow
            }));

            polygonSeries.mapPolygons.template.setAll({
                tooltipText: "{name}",
                toggleKey: "active",
                interactive: true,
                fill: am5.color(0x1a1f3a),
                stroke: am5.color(0x3b82f6),
                strokeWidth: 0.5
            });

            polygonSeries.mapPolygons.template.states.create("hover", {
                fill: am5.color(0x3b82f6)
            });

            // Create series for background fill
            const backgroundSeries = chart.series.push(am5map.MapPolygonSeries.new(root, {}));
            backgroundSeries.mapPolygons.template.setAll({
                fill: am5.color(0x0a0e27),
                fillOpacity: 0.5,
                strokeOpacity: 0
            });
            backgroundSeries.data.push({
                geometry: am5map.getGeoRectangle(90, 180, -90, -180)
            });

            // Add graticule
            const graticuleSeries = chart.series.unshift(
                am5map.GraticuleSeries.new(root, {
                    step: 10
                })
            );
            graticuleSeries.mapLines.template.set("strokeOpacity", 0.1);

            // Add point series for IP location
            const pointSeries = chart.series.push(am5map.MapPointSeries.new(root, {}));

            pointSeries.bullets.push(function () {
                const circle = am5.Circle.new(root, {
                    radius: 8,
                    fill: am5.color(0xef4444),
                    strokeWidth: 2,
                    stroke: am5.color(0xffffff),
                    tooltipText: `${domain}\n${geolocation.city}, ${geolocation.country}\nIP: ${geolocation.ip}`
                });

                // Pulse animation
                circle.animate({
                    key: "scale",
                    from: 1,
                    to: 1.5,
                    duration: 1000,
                    easing: am5.ease.inOut(am5.ease.cubic),
                    loops: Infinity
                });

                return am5.Bullet.new(root, {
                    sprite: circle
                });
            });

            // Add the IP location point
            pointSeries.data.push({
                geometry: { type: "Point", coordinates: [lon, lat] }
            });

            // Rotate globe to show the location
            chart.animate({
                key: "rotationX",
                to: -lon,
                duration: 1500,
                easing: am5.ease.inOut(am5.ease.cubic)
            });
            chart.animate({
                key: "rotationY",
                to: -lat,
                duration: 1500,
                easing: am5.ease.inOut(am5.ease.cubic)
            });

            // Make stuff animate on load
            chart.appear(1000, 100);
        }

        function displayDomainInfo(data) {
            document.getElementById('domainInfoContainer').style.display = 'block';

            const recon = data.reconnaissance || {};
            const geo = data.geolocation || {};
            const analysisDate = new Date().toLocaleString();

            // Process DNS records from array to grouped object
            const dnsRecords = {};
            if (recon.dns && Array.isArray(recon.dns)) {
                recon.dns.forEach(record => {
                    if (!dnsRecords[record.type]) {
                        dnsRecords[record.type] = [];
                    }
                    if (record.value !== 'No records found') {
                        dnsRecords[record.type].push(record.value);
                    }
                });
            }

            // Extract server and technologies
            let serverTech = 'Not detected';
            let techs = [];
            if (recon.technologies && Array.isArray(recon.technologies)) {
                recon.technologies.forEach(tech => {
                    if (typeof tech === 'string') {
                        if (tech.toLowerCase().startsWith('server:')) {
                            serverTech = tech.replace(/^server:\s*/i, '');
                        } else {
                            techs.push(tech);
                        }
                    }
                });
            }

            let html = `
                <table class="domain-info-table">
                    <tr>
                        <th>Domain</th>
                        <td>${data.domain}</td>
                    </tr>
                    <tr>
                        <th>Status</th>
                        <td style="color: ${data.authenticity?.is_genuine ? 'var(--success-color)' : 'var(--warning-color)'};">
                            ${data.authenticity?.is_genuine ? 'Active & Genuine' : 'Potential Risk Detected'}
                        </td>
                    </tr>
                    <tr>
                        <th>Analysis Date</th>
                        <td>${analysisDate}</td>
                    </tr>
                    <tr>
                        <th colspan="2" style="background: rgba(59, 130, 246, 0.1); padding: 1rem;">
                            <i class="fas fa-network-wired"></i> DNS Records
                        </th>
                    </tr>
                    <tr>
                        <th>A Records</th>
                        <td>${dnsRecords.A?.join(', ') || 'N/A'}</td>
                    </tr>
                    <tr>
                        <th>AAAA Records</th>
                        <td>${dnsRecords.AAAA?.join(', ') || 'N/A'}</td>
                    </tr>
                    <tr>
                        <th>MX Records</th>
                        <td>${dnsRecords.MX?.join(', ') || 'N/A'}</td>
                    </tr>
                    <tr>
                        <th>NS Records</th>
                        <td>${dnsRecords.NS?.join(', ') || 'N/A'}</td>
                    </tr>
                    <tr>
                        <th>TXT Records</th>
                        <td style="word-break: break-all;">${dnsRecords.TXT?.join(', ') || 'N/A'}</td>
                    </tr>
                    <tr>
                        <th colspan="2" style="background: rgba(59, 130, 246, 0.1); padding: 1rem;">
                            <i class="fas fa-shield-alt"></i> Security Headers
                        </th>
                    </tr>
                    ${recon.security_headers ? Object.entries(recon.security_headers).map(([key, value]) => `
                        <tr>
                            <th>${key}</th>
                            <td style="color: ${value === 'Not set' || value === 'Not Set' ? 'var(--warning-color)' : 'var(--success-color)'};">
                                ${value || 'Not set'}
                            </td>
                        </tr>
                    `).join('') : ''}
                    <tr>
                        <th colspan="2" style="background: rgba(59, 130, 246, 0.1); padding: 1rem;">
                            <i class="fas fa-code"></i> Detected Technologies
                        </th>
                    </tr>
                    <tr>
                        <th>Server</th>
                        <td>${serverTech}</td>
                    </tr>
                    <tr>
                        <th>Technologies</th>
                        <td>${techs.length > 0 ? techs.join(', ') : 'Not detected'}</td>
                    </tr>
                </table>
            `;

            document.getElementById('domain-info-content').innerHTML = html;
        }

        function displayOWASPResults(owaspData) {
            document.getElementById('owaspContainer').style.display = 'block';

            const score = owaspData.security_score || 0;
            const riskLevel = owaspData.risk_level || 'Unknown';
            const riskColor = riskLevel === 'Low' ? 'var(--success-color)' :
                              riskLevel === 'Medium' ? 'var(--warning-color)' :
                              'var(--danger-color)';

            let html = `
                <div style="display: flex; align-items: center; gap: 2rem; margin-bottom: 2rem; padding: 1.5rem; background: var(--dark-bg); border-radius: 12px;">
                    <div style="width: 100px; height: 100px; border-radius: 50%; background: conic-gradient(${riskColor} ${score * 3.6}deg, var(--border-color) 0deg); display: flex; align-items: center; justify-content: center;">
                        <div style="width: 75px; height: 75px; border-radius: 50%; background: var(--card-bg); display: flex; align-items: center; justify-content: center; flex-direction: column;">
                            <div style="font-size: 1.5rem; font-weight: bold;">${score}</div>
                            <div style="font-size: 0.75rem; color: var(--text-secondary);">/ 100</div>
                        </div>
                    </div>
                    <div style="flex: 1;">
                        <h4 style="margin-bottom: 0.5rem;">Security Score: ${score}/100</h4>
                        <div style="color: ${riskColor}; font-weight: 600; font-size: 1.2rem; margin-bottom: 0.5rem;">
                            Risk Level: ${riskLevel}
                        </div>
                        <div style="color: var(--text-secondary);">
                            Vulnerabilities: ${owaspData.vulnerabilities?.length || 0} |
                            Warnings: ${owaspData.warnings?.length || 0} |
                            Passed: ${owaspData.passed?.length || 0}
                        </div>
                    </div>
                </div>
            `;

            // Display vulnerabilities
            if (owaspData.vulnerabilities && owaspData.vulnerabilities.length > 0) {
                html += '<h4 style="color: var(--danger-color); margin-bottom: 1rem;"><i class="fas fa-exclamation-circle"></i> Critical Vulnerabilities</h4>';
                html += '<div class="owasp-results">';
                owaspData.vulnerabilities.forEach(vuln => {
                    html += `
                        <div class="owasp-item vulnerable">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                <strong>${vuln.check}</strong>
                                <span class="owasp-badge vulnerable">${vuln.category || 'VULNERABLE'}</span>
                            </div>
                            <div style="color: var(--text-secondary); margin-bottom: 0.5rem;">${vuln.description || ''}</div>
                            ${vuln.issues && vuln.issues.length > 0 ? `
                                <ul style="margin: 0.5rem 0 0 1rem; color: var(--danger-color);">
                                    ${vuln.issues.map(issue => `<li>${issue}</li>`).join('')}
                                </ul>
                            ` : ''}
                        </div>
                    `;
                });
                html += '</div>';
            }

            // Display warnings
            if (owaspData.warnings && owaspData.warnings.length > 0) {
                html += '<h4 style="color: var(--warning-color); margin: 2rem 0 1rem;"><i class="fas fa-exclamation-triangle"></i> Security Warnings</h4>';
                html += '<div class="owasp-results">';
                owaspData.warnings.forEach(warning => {
                    html += `
                        <div class="owasp-item warning">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                <strong>${warning.check}</strong>
                                <span class="owasp-badge warning">${warning.category || 'WARNING'}</span>
                            </div>
                            <div style="color: var(--text-secondary); margin-bottom: 0.5rem;">${warning.description || ''}</div>
                            ${warning.issues && warning.issues.length > 0 ? `
                                <ul style="margin: 0.5rem 0 0 1rem; color: var(--warning-color);">
                                    ${warning.issues.map(issue => `<li>${issue}</li>`).join('')}
                                </ul>
                            ` : ''}
                        </div>
                    `;
                });
                html += '</div>';
            }

            // Display recommendations
            if (owaspData.recommendations && owaspData.recommendations.length > 0) {
                html += '<h4 style="color: var(--primary-color); margin: 2rem 0 1rem;"><i class="fas fa-lightbulb"></i> Security Recommendations</h4>';
                html += '<ul style="margin-left: 1rem; color: var(--text-primary);">';
                owaspData.recommendations.forEach(rec => {
                    html += `<li style="margin-bottom: 0.5rem;">${rec}</li>`;
                });
                html += '</ul>';
            }

            document.getElementById('owasp-results').innerHTML = html;
        }

        function displayWaybackData(waybackData, domain) {
            if (!waybackData.success && !waybackData.is_archived) {
                return;
            }

            document.getElementById('waybackContainer').style.display = 'block';

            let html = '';

            if (!waybackData.is_archived) {
                html = `
                    <div class="no-snapshots">
                        <i class="fas fa-archive"></i>
                        <h3>No Archives Found</h3>
                        <p>This domain has not been archived by the Wayback Machine yet.</p>
                    </div>
                `;
                document.getElementById('wayback-content').innerHTML = html;
                return;
            }

            const closest = waybackData.closest_snapshot;
            const totalSnapshots = waybackData.total_snapshots || 0;
            const firstSnapshot = waybackData.first_snapshot;
            const lastSnapshot = waybackData.last_snapshot;
            const yearsActive = waybackData.years_active || [];

            html += `
                <div style="margin-bottom: 2rem;">
                    <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                        This domain has been archived ${totalSnapshots} times by the Wayback Machine,
                        spanning ${yearsActive.length} years of history.
                    </p>
                    ${closest ? `
                        <a href="${closest.url}" target="_blank" class="wayback-archive-link">
                            <i class="fas fa-external-link-alt"></i>
                            View Most Recent Archive (${closest.date})
                        </a>
                    ` : ''}
                </div>

                <div class="wayback-stats">
                    <div class="wayback-stat">
                        <div class="wayback-stat-value">${totalSnapshots}</div>
                        <div class="wayback-stat-label">Total Snapshots</div>
                    </div>
                    <div class="wayback-stat">
                        <div class="wayback-stat-value">${yearsActive.length}</div>
                        <div class="wayback-stat-label">Years Active</div>
                    </div>
                    ${firstSnapshot ? `
                        <div class="wayback-stat">
                            <div class="wayback-stat-value" style="font-size: 1.5rem;">${firstSnapshot.year}</div>
                            <div class="wayback-stat-label">First Archive</div>
                        </div>
                    ` : ''}
                    ${lastSnapshot ? `
                        <div class="wayback-stat">
                            <div class="wayback-stat-value" style="font-size: 1.5rem;">${lastSnapshot.year}</div>
                            <div class="wayback-stat-label">Latest Archive</div>
                        </div>
                    ` : ''}
                </div>
            `;

            if (yearsActive.length > 0) {
                html += `
                    <div class="timeline-container">
                        <h4 style="margin-bottom: 1rem;">
                            <i class="fas fa-calendar-alt"></i> Archive Timeline
                        </h4>
                        <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                            Click a year to view snapshots from that period
                        </p>
                        <div class="timeline">
                            ${yearsActive.map(year => `
                                <div class="timeline-year" onclick="filterSnapshotsByYear(${year}, '${domain}')">${year}</div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }

            const snapshots = waybackData.snapshots || [];
            if (snapshots.length > 0) {
                html += `
                    <div style="margin-top: 2rem;">
                        <h4 style="margin-bottom: 1rem;">
                            <i class="fas fa-images"></i> Archived Snapshots
                        </h4>
                        <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                            Showing ${Math.min(snapshots.length, 20)} most recent snapshots
                        </p>
                        <div class="snapshot-gallery">
                            ${snapshots.slice(0, 20).map((snapshot, index) => `
                                <div class="snapshot-card" onclick="window.open('${snapshot.url}', '_blank')">
                                    <div class="snapshot-thumbnail">
                                        <img src="${snapshot.screenshot_url}"
                                             alt="Snapshot from ${snapshot.date}"
                                             loading="lazy"
                                             onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
                                             onload="this.classList.add('loaded'); this.nextElementSibling.style.display='none';">
                                        <div class="snapshot-thumbnail-placeholder">
                                            <i class="fas fa-camera-retro"></i>
                                            <div style="font-size: 0.85rem;">Preview Image</div>
                                        </div>
                                    </div>
                                    <div class="snapshot-info">
                                        <div class="snapshot-date">${snapshot.date}</div>
                                        <div class="snapshot-timestamp">
                                            <i class="fas fa-clock"></i> ${snapshot.timestamp}
                                        </div>
                                        <div class="snapshot-actions">
                                            <a href="${snapshot.url}" target="_blank" class="snapshot-btn" onclick="event.stopPropagation();">
                                                <i class="fas fa-eye"></i> View Archive
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }

            html += `
                <div style="margin-top: 2rem; padding: 1.5rem; background: rgba(59, 130, 246, 0.05); border-radius: 12px; border: 1px solid var(--border-color);">
                    <h4 style="margin-bottom: 1rem;">
                        <i class="fas fa-info-circle"></i> About Wayback Machine
                    </h4>
                    <p style="color: var(--text-secondary); line-height: 1.8;">
                        The Wayback Machine is a digital archive of the World Wide Web maintained by the Internet Archive.
                        It allows you to see how websites looked in the past, track changes over time, and recover
                        content that may no longer be available on the live web.
                    </p>
                    <a href="https://web.archive.org/web/*/${domain}" target="_blank" class="wayback-archive-link" style="margin-top: 1rem;">
                        <i class="fas fa-archive"></i>
                        View Complete Archive History
                    </a>
                </div>
            `;

            document.getElementById('wayback-content').innerHTML = html;

            // Store snapshots globally for filtering
            window.currentWaybackData = waybackData;
            window.currentDomain = domain;
        }

        function filterSnapshotsByYear(year, domain) {
            // Remove active class from all years
            document.querySelectorAll('.timeline-year').forEach(el => {
                el.classList.remove('active');
            });

            // Add active class to clicked year
            event.target.classList.add('active');

            // Filter snapshots by year
            const allSnapshots = window.currentWaybackData?.snapshots || [];
            const filteredSnapshots = allSnapshots.filter(snapshot => {
                return snapshot.year === year.toString();
            });

            // Update the gallery
            const galleryContainer = document.querySelector('.snapshot-gallery');
            if (galleryContainer && filteredSnapshots.length > 0) {
                galleryContainer.innerHTML = filteredSnapshots.slice(0, 20).map(snapshot => `
                    <div class="snapshot-card" onclick="window.open('${snapshot.url}', '_blank')">
                        <div class="snapshot-thumbnail">
                            <img src="${snapshot.screenshot_url}"
                                 alt="Snapshot from ${snapshot.date}"
                                 loading="lazy"
                                 onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
                                 onload="this.classList.add('loaded'); this.nextElementSibling.style.display='none';">
                            <div class="snapshot-thumbnail-placeholder">
                                <i class="fas fa-camera-retro"></i>
                                <div style="font-size: 0.85rem;">Preview Image</div>
                            </div>
                        </div>
                        <div class="snapshot-info">
                            <div class="snapshot-date">${snapshot.date}</div>
                            <div class="snapshot-timestamp">
                                <i class="fas fa-clock"></i> ${snapshot.timestamp}
                            </div>
                            <div class="snapshot-actions">
                                <a href="${snapshot.url}" target="_blank" class="snapshot-btn" onclick="event.stopPropagation();">
                                    <i class="fas fa-eye"></i> View Archive
                                </a>
                            </div>
                        </div>
                    </div>
                `).join('');

                // Update count text
                const countText = document.querySelector('.snapshot-gallery').previousElementSibling;
                if (countText && countText.tagName === 'P') {
                    countText.textContent = `Showing ${Math.min(filteredSnapshots.length, 20)} snapshots from ${year}`;
                }
            } else if (galleryContainer) {
                galleryContainer.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 2rem; color: var(--text-secondary);">
                        <i class="fas fa-calendar-times" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.3;"></i>
                        <p>No snapshots found for ${year}</p>
                    </div>
                `;
            }
        }

        function addToMonitoring() {
            const domain = document.getElementById('monitorDomainInput').value.trim();
            
            if (!domain) {
                showToast('Please enter a domain', 'warning');
                return;
            }
            
            document.getElementById('addMonitorBtn').disabled = true;
            document.getElementById('addMonitorBtn').innerHTML = '<div class="loading"></div> Adding...';
            
            fetch('/api/monitoring/public', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ domain: domain }),
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    throw new Error(data.error);
                }
                
                showToast('Domain added to public monitoring!', 'success');
                document.getElementById('monitorDomainInput').value = '';
                loadPublicMonitoring();
            })
            .catch(error => {
                showToast('Error adding to monitoring: ' + error.message, 'error');
            })
            .finally(() => {
                document.getElementById('addMonitorBtn').disabled = false;
                document.getElementById('addMonitorBtn').innerHTML = '<i class="fas fa-plus"></i> Add to Monitoring';
            });
        }
        
        function loadPublicMonitoring() {
            fetch('/api/monitoring/public')
                .then(response => response.json())
                .then(data => {
                    const container = document.getElementById('monitoringList');
                    
                    if (data.length === 0) {
                        container.innerHTML = '<p class="progress-text">No domains being monitored yet.</p>';
                        return;
                    }
                    
                    let html = '';
                    data.forEach(job => {
                        const lastScan = job.last_scan ? new Date(job.last_scan).toLocaleString() : 'Never';
                        const hasUpdates = job.has_updates || false;
                        
                        html += `
                            <div class="monitoring-item">
                                <div>
                                    <div class="monitoring-domain">${job.domain}</div>
                                    <div style="color: var(--text-secondary); font-size: 0.9rem;">
                                        Last scan: ${lastScan} | Changes: ${job.change_count || 0}
                                    </div>
                                </div>
                                <div class="monitoring-status">
                                    <div class="status-indicator ${hasUpdates ? 'has-updates' : ''}"></div>
                                    <span>${hasUpdates ? 'Has Updates' : 'Monitoring'}</span>
                                </div>
                            </div>
                        `;
                    });
                    
                    container.innerHTML = html;
                })
                .catch(error => {
                    document.getElementById('monitoringList').innerHTML = 
                        '<p class="progress-text" style="color: var(--danger-color);">Error loading monitoring list</p>';
                });
        }

        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => toast.classList.add('show'), 100);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => document.body.removeChild(toast), 300);
            }, 3000);
        }
    </script>
</body>
</html>